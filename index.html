<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Chat - Audio Edition</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.4s, color 0.4s; }
        body { display: flex; height: 100vh; overflow: hidden; position: relative; font-family: 'Comic Sans MS', cursive; }

        /* --- EST√âTICA GERAL --- */
        body.fofo { background-color: #fff0f5; color: #ff69b4; }
        body.dark { background-color: #050000; color: #ff0000; font-family: 'Courier New', monospace; }

        #left-panel { flex: 1; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; border-right: 1px solid rgba(0,0,0,0.1); }
        .dark #left-panel { border-right: 1px solid #440000; background: radial-gradient(circle, #1a0000 0%, #000 70%); }

        #chat-panel { flex: 1.2; display: flex; flex-direction: column; z-index: 5; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); }
        .dark #chat-panel { background: rgba(0, 0, 0, 0.92); }

        /* --- CHATS E MENSAGENS --- */
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: none; flex-direction: column; gap: 12px; }
        .active-chat { display: flex; }

        .message { max-width: 85%; padding: 12px; font-size: 14px; animation: fadeIn 0.3s forwards; }
        .fofo .msg-me { background: #ffb6c1; align-self: flex-end; border-radius: 15px 15px 0 15px; }
        .dark .msg-me { background: #300000; align-self: flex-end; border: 1px solid #ff0000; }
        
        audio { max-width: 100%; margin-top: 5px; height: 35px; }

        /* --- BOT√ÉO DE GRAVAR --- */
        #input-area { padding: 20px; display: flex; gap: 10px; border-top: 1px solid rgba(0,0,0,0.1); align-items: center; }
        .btn-audio { border: none; width: 60px; height: 60px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; transition: 0.2s; }
        .fofo .btn-audio { background: #ff69b4; color: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(255,105,180,0.3); }
        .dark .btn-audio { background: #660000; color: white; border-radius: 0; box-shadow: 0 0 15px #ff0000; }
        
        .recording { background: #ff0000 !important; animation: pulse 1s infinite; transform: scale(1.1); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(255,0,0,0.7); } 70% { box-shadow: 0 0 0 20px rgba(255,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(255,0,0,0); } }

        #toggle-btn { font-size: 110px; cursor: pointer; z-index: 10; user-select: none; }
    </style>
</head>
<body class="fofo">

    <div id="left-panel">
        <div id="toggle-btn">‚≠ê</div>
    </div>

    <div id="chat-panel">
        <header style="padding: 20px; text-align: center; font-weight: bold;" id="main-header">Conversas Amig√°veis</header>
        <div id="messages-fofo" class="chat-container active-chat"></div>
        <div id="messages-dark" class="chat-container"></div>

        <div id="input-area">
            <button id="record-btn" class="btn-audio">üé§</button>
            <p id="record-status" style="font-size: 12px;">Segure para gravar</p>
        </div>
    </div>

    <script>
        const socket = io();
        const body = document.body;
        const recordBtn = document.getElementById('record-btn');
        let mediaRecorder;
        let audioChunks = [];

        // --- L√ìGICA DE GRAVA√á√ÉO DE √ÅUDIO ---
        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };

            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const reader = new FileReader();
                reader.readAsDataURL(audioBlob); 
                reader.onloadend = () => {
                    const base64String = reader.result;
                    const mode = body.classList.contains('fofo') ? 'fofo' : 'dark';
                    
                    // Envia o √°udio via socket
                    socket.emit('chat message', {
                        user: "Usu√°rio " + Math.floor(Math.random() * 999),
                        audio: base64String,
                        mode: mode
                    });
                };
                audioChunks = [];
            };
        });

        recordBtn.addEventListener('mousedown', () => {
            if (mediaRecorder) {
                mediaRecorder.start();
                recordBtn.classList.add('recording');
                document.getElementById('record-status').innerText = "Gravando...";
            }
        });

        recordBtn.addEventListener('mouseup', () => {
            if (mediaRecorder) {
                mediaRecorder.stop();
                recordBtn.classList.remove('recording');
                document.getElementById('record-status').innerText = "Enviado!";
                setTimeout(() => document.getElementById('record-status').innerText = "Segure para gravar", 2000);
            }
        });

        // --- RECEBER √ÅUDIO ---
        socket.on('chat message', (msg) => {
            const item = document.createElement('div');
            item.className = 'message msg-others'; // Simplificado para o exemplo
            item.innerHTML = `<strong>${msg.user}:</strong><br>`;
            
            const audio = document.createElement('audio');
            audio.controls = true;
            audio.src = msg.audio;
            item.appendChild(audio);

            const targetChat = msg.mode === 'fofo' ? document.getElementById('messages-fofo') : document.getElementById('messages-dark');
            targetChat.appendChild(item);
            targetChat.scrollTop = targetChat.scrollHeight;

            // Autodestrui√ß√£o em 5 minutos
            setTimeout(() => item.remove(), 300000);
        });

        // --- TROCA DE TEMA (Simplificada) ---
        document.getElementById('toggle-btn').addEventListener('click', () => {
            const chatFofo = document.getElementById('messages-fofo');
            const chatDark = document.getElementById('messages-dark');
            if (body.classList.contains('fofo')) {
                body.className = 'dark';
                document.getElementById('toggle-btn').innerText = 'üéà';
                chatFofo.classList.remove('active-chat');
                chatDark.classList.add('active-chat');
            } else {
                body.className = 'fofo';
                document.getElementById('toggle-btn').innerText = '‚≠ê';
                chatDark.classList.remove('active-chat');
                chatFofo.classList.add('active-chat');
            }
        });
    </script>
</body>
</html>


