<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>BIPOLAR - ELITE SYSTEM</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --main: #ffb7ce; --bg: #ffffff; --text: #000; --border: #ffb7ce; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Courier New', Courier, monospace; }
        body { background: var(--bg); height: 100vh; display: flex; color: var(--text); overflow: hidden; transition: 0.5s; }
        
        #login-screen { position: fixed; inset: 0; background: #000; z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .login-box { border: 3px solid #ff0055; padding: 40px; border-radius: 10px; text-align: center; background: #050505; width: 320px; }
        
        /* Layout Lateral Esquerdo */
        .game-panel { width: 350px; border-right: 2px solid var(--border); display: flex; flex-direction: column; padding: 20px; align-items: center; z-index: 10; background: var(--bg); }
        .nav-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        .nav-btn { padding: 10px; border: 2px solid var(--border); background: none; color: var(--text); cursor: pointer; font-weight: bold; font-size: 11px; }
        .active-btn { background: var(--border); color: #fff; }
        #ranking-box { border: 1px solid var(--border); width: 100%; padding: 10px; margin-top: 20px; }
        .rank-title { text-align: center; border-bottom: 1px solid var(--border); font-weight: bold; padding-bottom: 5px; margin-bottom: 10px; }

        /* √Årea do Jogo Central */
        .main-stage { flex: 1; position: relative; overflow: hidden; cursor: crosshair; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #canvas { position: absolute; inset: 0; }
        #big-score { font-size: 80px; color: var(--border); font-weight: bold; z-index: 5; opacity: 0.5; }
        
        /* Chat Direita */
        .chat-area { width: 400px; border-left: 2px solid var(--border); display: flex; flex-direction: column; background: var(--bg); }
        #messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .msg-box { padding: 15px; border-top: 2px solid var(--border); background: var(--bg); }
        #msg-in { width: 100%; padding: 12px; border: 1px solid var(--border); background: none; color: var(--text); margin-bottom: 10px; outline: none; }
        .btn-row { display: flex; gap: 5px; }
        .btn-row button { flex: 1; padding: 8px; border: 1px solid var(--border); background: none; color: var(--text); cursor: pointer; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="login-screen">
        <div class="login-box">
            <h1 style="color:#ff0055; margin-bottom: 20px;">BIPOLAR</h1>
            <input type="text" id="nick" placeholder="APELIDO" maxlength="10" style="width:100%; padding:12px; margin-bottom:20px; background:#111; border:1px solid #ff0055; color:#fff; text-align:center;">
            <button onclick="entrar()" style="width:100%; padding:12px; background:#ff0055; color:#fff; border:none; cursor:pointer; font-weight:bold;">ACESSAR</button>
        </div>
    </div>

    <div class="game-panel">
        <div class="nav-bar">
            <button id="btn-sky" class="nav-btn active-btn" onclick="mudar('sky')">MODO C√âU üíñ</button>
            <button id="btn-hell" class="nav-btn" onclick="mudar('hell')">MODO INFERNAL üíÄ</button>
        </div>
        <div id="ranking-box">
            <div class="rank-title">TOP 5 ELITE</div>
            <div id="ranking-list"></div>
        </div>
    </div>

    <div class="main-stage">
        <canvas id="canvas"></canvas>
        <div id="big-score">0</div>
    </div>

    <div class="chat-area">
        <div id="messages"></div>
        <div class="msg-box">
            <input type="text" id="msg-in" placeholder="Escreva aqui..." onkeypress="if(event.key==='Enter') enviar()">
            <div class="btn-row">
                <button onclick="enviar()">ENVIAR</button>
                <button>IMAGEM</button>
                <button>üé§ GRAVAR</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let user = "", sala = "sky", placarLocal = 0;
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];

        function entrar() {
            const n = document.getElementById('nick').value.trim();
            if(!n) return alert("Digite um apelido!");
            socket.emit('login request', n, (res) => {
                if(res.success) {
                    user = n;
                    document.getElementById('login-screen').style.display = 'none';
                    socket.emit('join room', sala);
                    animate();
                } else alert(res.message);
            });
        }

        function mudar(m) {
            sala = m;
            const root = document.documentElement;
            if(m === 'sky') {
                root.style.setProperty('--main', '#ffb7ce');
                root.style.setProperty('--bg', '#ffffff');
                root.style.setProperty('--text', '#000');
                root.style.setProperty('--border', '#ffb7ce');
            } else {
                root.style.setProperty('--main', '#ff3300');
                root.style.setProperty('--bg', '#000000');
                root.style.setProperty('--text', '#ffffff');
                root.style.setProperty('--border', '#ff3300');
            }
            document.getElementById('btn-sky').classList.toggle('active-btn', m === 'sky');
            document.getElementById('btn-hell').classList.toggle('active-btn', m === 'hell');
            particles = [];
            socket.emit('join room', sala);
        }

        canvas.addEventListener('mousedown', (e) => {
            particles.forEach((p) => {
                if(!p.exploded && e.clientX > p.x && e.clientX < p.x + 60 && e.clientY > p.y - 60 && e.clientY < p.y) {
                    p.exploded = true;
                    placarLocal++;
                    document.getElementById('big-score').innerText = placarLocal;
                    
                    // Sistema de Conquistas
                    if(placarLocal === 100) alert("Caramba, voc√™ est√° mandando bem!!!!");
                    else if(placarLocal === 200) alert("Voc√™ √© um verdadeiro viciado em serotonina");
                    else if(placarLocal === 300) alert("Nossa, voc√™ perdeu a no√ß√£o do tempo");
                    else if(placarLocal === 400) alert("voc√™ √© um g√™nio da mira");
                    else if(placarLocal === 500) {
                        alert("parab√©ns, voc√™ agora √© o rei de explodir bal√µes");
                        user += " üëë";
                    }
                    
                    socket.emit('update score', { room: sala });
                }
            });
        });

        function animate() {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            if(Math.random() < 0.04) {
                particles.push({ 
                    x: Math.random() * (canvas.width - 400) + 50, 
                    y: canvas.height + 50, 
                    exploded: false,
                    speed: Math.random() * 2 + 1
                });
            }
            particles.forEach((p, i) => {
                p.y -= p.speed;
                ctx.font = "50px Arial";
                ctx.fillText(p.exploded ? "üí•" : (sala === 'sky' ? "üíñ" : "üíÄ"), p.x, p.y);
                if(p.y < -100) particles.splice(i, 1);
            });
            requestAnimationFrame(animate);
        }

        function enviar() {
            const i = document.getElementById('msg-in');
            if(i.value) {
                socket.emit('chat message', { room: sala, user: user, text: i.value });
                i.value = "";
            }
        }

        socket.on('chat message', d => {
            const msgArea = document.getElementById('messages');
            const p = document.createElement('p');
            p.innerHTML = `<b>${d.user}:</b> ${d.text}`;
            msgArea.appendChild(p);
            msgArea.scrollTop = msgArea.scrollHeight;
        });

        socket.on('update ranking', r => {
            const list = document.getElementById('ranking-list');
            list.innerHTML = r.map((u, i) => `<div style="padding:3px 0;">${i+1}. ${u.name} - ${u.score}</div>`).join('');
        });

        socket.on('error message', m => {
            alert(m);
            location.reload();
        });

        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
    </script>
</body>
</html>
