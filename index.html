<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Chat - Multi-funcional</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.4s, color 0.4s; }
        body { display: flex; height: 100vh; overflow: hidden; position: relative; font-family: 'Comic Sans MS', cursive; }

        /* --- TEMAS --- */
        body.fofo { background-color: #fff0f5; color: #ff69b4; }
        body.dark { background-color: #050000; color: #ff0000; font-family: 'Courier New', monospace; }

        #left-panel { flex: 1; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; border-right: 1px solid rgba(0,0,0,0.1); }
        .dark #left-panel { border-right: 1px solid #440000; background: radial-gradient(circle, #1a0000 0%, #000 70%); }

        #chat-panel { flex: 1.2; display: flex; flex-direction: column; z-index: 5; background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(8px); }
        .dark #chat-panel { background: rgba(0, 0, 0, 0.92); }

        /* --- MENSAGENS --- */
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: none; flex-direction: column; gap: 12px; }
        .active-chat { display: flex; }
        .message { max-width: 85%; padding: 12px; font-size: 14px; animation: fadeIn 0.3s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; } }

        .fofo .msg-me { background: #ffb6c1; color: white; align-self: flex-end; border-radius: 15px 15px 0 15px; }
        .fofo .msg-others { background: white; border: 1px solid #ffb6c1; align-self: flex-start; border-radius: 15px 15px 15px 0; }
        .dark .msg-me { background: #300000; color: #ff0000; align-self: flex-end; border: 1px solid #ff0000; }
        .dark .msg-others { background: #111; color: #666; align-self: flex-start; border-left: 3px solid #444; }

        audio { max-width: 100%; margin-top: 5px; height: 35px; filter: sepia(1) hue-rotate(-50deg) saturate(5); }
        .message img { max-width: 100%; border-radius: 8px; margin-top: 5px; }
        .gemini-message { background-color: #e6ffe6 !important; border-left: 5px solid #00c853 !important; color: #00796b !important; border-radius: 0 15px 15px 15px !important; }
        .dark .gemini-message { background-color: #262626 !important; border-left: 5px solid #00c853 !important; color: #00c853 !important; }


        /* --- INPUT AREA --- */
        #input-area { padding: 20px; display: flex; gap: 8px; border-top: 1px solid rgba(0,0,0,0.1); align-items: center; }
        .dark #input-area { border-top: 1px solid #440000; }
        
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ccc; outline: none; font-family: inherit; }
        .dark input { background: #000; border: 1px solid #440000; color: #ff0000; border-radius: 0; }

        .btn-action { border: none; width: 45px; height: 45px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: 0.2s; }
        .fofo .btn-action { background: #ff69b4; color: white; border-radius: 50%; }
        .dark .btn-action { background: #660000; color: white; border-radius: 0; }

        .recording { background: red !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        #toggle-btn { font-size: 110px; cursor: pointer; z-index: 10; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>
</head>
<body class="fofo">

    <div id="left-panel">
        <div id="toggle-btn">‚≠ê</div>
    </div>

    <div id="chat-panel">
        <header style="padding: 20px; text-align: center; font-weight: bold;" id="main-header">Conversas Amig√°veis</header>
        <div id="messages-fofo" class="chat-container active-chat"></div>
        <div id="messages-dark" class="chat-container"></div>

        <form id="input-area">
            <input type="file" id="image-upload" accept="image/*" style="display: none;">
            <button type="button" id="upload-btn" class="btn-action" title="Enviar Imagem">üñºÔ∏è</button>
            <button type="button" id="record-btn" class="btn-action" title="Gravar √Åudio">üé§</button>
            <input id="m" autocomplete="off" placeholder="Escreva ou segure o mic..." />
            <button type="submit" id="send-btn" class="btn-action" title="Enviar Mensagem">‚ûú</button>
        </form>
    </div>

    <script>
        const socket = io();
        const body = document.body;
        const toggleBtn = document.getElementById('toggle-btn');
        const inputField = document.getElementById('m');
        const recordBtn = document.getElementById('record-btn');
        const uploadBtn = document.getElementById('upload-btn');
        const imageUpload = document.getElementById('image-upload');
        const mainHeader = document.getElementById('main-header');
        const userNumber = Math.floor(Math.random() * 999);

        let mediaRecorder;
        let audioChunks = [];

        // --- CONFIGURA√á√ÉO DE √ÅUDIO ---
        navigator.mediaDevices.getUserMedia({ audio: true }).then(stream => {
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                const reader = new FileReader();
                reader.readAsDataURL(audioBlob);
                reader.onloadend = () => {
                    const mode = body.classList.contains('fofo') ? 'fofo' : 'dark';
                    socket.emit('chat message', { user: "Usu√°rio "+userNumber, audio: reader.result, mode: mode });
                };
                audioChunks = [];
            };
        });

        recordBtn.onmousedown = () => { if(mediaRecorder) { mediaRecorder.start(); recordBtn.classList.add('recording'); } };
        recordBtn.onmouseup = () => { if(mediaRecorder) { mediaRecorder.stop(); recordBtn.classList.remove('recording'); } };

        // --- ENVIO DE IMAGEM ---
        uploadBtn.onclick = () => imageUpload.click(); // Clica no input file escondido
        imageUpload.onchange = (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const mode = body.classList.contains('fofo') ? 'fofo' : 'dark';
                    socket.emit('chat message', { user: "Usu√°rio "+userNumber, image: e.target.result, mode: mode });
                };
                reader.readAsDataURL(file);
            }
        };

        // --- ENVIO DE TEXTO ---
        document.getElementById('input-area').onsubmit = (e) => {
            e.preventDefault();
            if (inputField.value.trim()) {
                const mode = body.classList.contains('fofo') ? 'fofo' : 'dark';
                const messageText = inputField.value;
                socket.emit('chat message', { user: "Usu√°rio "+userNumber, text: messageText, mode: mode });
                inputField.value = '';

                // SIMULA√á√ÉO DO GEMINI
                if (messageText.toLowerCase().includes('gemini')) { // Se a mensagem contiver "gemini"
                    setTimeout(() => {
                        socket.emit('chat message', {
                            user: "Gemini_AI", // Usu√°rio especial para Gemini
                            text: "Ol√°! Como posso ajudar voc√™ hoje?",
                            mode: mode,
                            isGemini: true // Flag para estilizar diferente
                        });
                    }, 1500); // Responde ap√≥s 1.5 segundos
                }
            }
        };

        // --- RECEBER MENSAGENS (TEXTO, √ÅUDIO OU IMAGEM) ---
        socket.on('chat message', (msg) => {
            const item = document.createElement('div');
            const isMe = msg.user === "Usu√°rio " + userNumber;
            item.className = isMe ? 'message msg-me' : 'message msg-others';

            if (msg.isGemini) { // Adiciona classe para Gemini
                item.classList.add('gemini-message');
            }
            
            if (msg.text) {
                item.innerHTML = `<strong>${msg.user}:</strong><br>${msg.text}`;
            } else if (msg.audio) {
                item.innerHTML = `<strong>${msg.user}:</strong><br>`;
                const audio = document.createElement('audio');
                audio.controls = true;
                audio.src = msg.audio;
                item.appendChild(audio);
            } else if (msg.image) {
                item.innerHTML = `<strong>${msg.user}:</strong><br>`;
                const img = document.createElement('img');
                img.src = msg.image;
                item.appendChild(img);
            }

            const targetChat = msg.mode === 'fofo' ? document.getElementById('messages-fofo') : document.getElementById('messages-dark');
            targetChat.appendChild(item);
            targetChat.scrollTop = targetChat.scrollHeight;

            // Autodestrui√ß√£o em 5 minutos (300.000 ms)
            setTimeout(() => item.remove(), 300000);
        });

        // --- TROCA DE TEMA ---
        toggleBtn.onclick = () => {
            const chatFofo = document.getElementById('messages-fofo');
            const chatDark = document.getElementById('messages-dark');
            if (body.classList.contains('fofo')) {
                body.className = 'dark'; toggleBtn.innerText = 'üéà';
                chatFofo.classList.remove('active-chat'); chatDark.classList.add('active-chat');
                mainHeader.innerText = "Conversas Nada Amig√°veis";
            } else {
                body.className = 'fofo'; toggleBtn.innerText = '‚≠ê';
                chatDark.classList.remove('active-chat'); chatFofo.classList.add('active-chat');
                mainHeader.innerText = "Conversas Amig√°veis";
            }
        };
    </script>
</body>
</html>



