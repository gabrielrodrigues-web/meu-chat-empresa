<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Minecraft Pro Chat: WORLD Edition</title>
    
    <style>
        @import url('https://fonts.cdnfonts.com/css/minecraftia');
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        * { box-sizing: border-box; }
        body { margin: 0; display: flex; height: 100vh; overflow: hidden; background: #1a1a1a; font-family: 'Minecraftia', sans-serif; }
        
        /* TELA DE LOGIN */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 1000;
            display: flex; justify-content: center; align-items: center;
        }
        .login-box {
            background: #333; border: 4px solid #000; padding: 40px;
            width: 350px; text-align: center; color: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .login-box h2 { color: #ff4d7d; margin-bottom: 25px; font-size: 20px; }
        .login-box input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            background: #000; border: 2px solid #555; color: #ff4d7d;
            font-family: 'Share Tech Mono', monospace; outline: none;
        }
        .login-box button {
            width: 100%; padding: 12px; background: #ff4d7d;
            border: none; color: white; cursor: pointer;
            font-family: 'Minecraftia', sans-serif; font-weight: bold;
        }

        /* ESTRUTURA DO CHAT */
        #main-wrapper { display: none; width: 100%; height: 100%; }
        #sidebar { width: 30%; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; z-index: 10; border-right: 4px solid #ffeef2; background: #fff;}
        #chat-container { width: 70%; display: flex; flex-direction: column; position: relative; }
        
        #toggle-btn { font-size: 130px; cursor: pointer; user-select: none; z-index: 11; transition: 0.3s; }
        #score-board { margin-top: 20px; font-size: 20px; font-weight: bold; z-index: 11; padding: 10px 20px; border: 3px solid; transition: 0.1s; }
        .bump { transform: scale(1.2); }

        #header { padding: 30px; text-align: center; font-size: 24px; font-weight: bold; border-bottom: 4px solid rgba(0,0,0,0.05); }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        .message { max-width: 80%; padding: 15px; border-radius: 12px; font-size: 14px; word-wrap: break-word; position: relative;}
        .my-message { align-self: flex-end; background: #ff85a2 !important; color: white !important; }

        /* TEMAS */
        .theme-amigavel { background-color: #fff; color: #555; }
        .theme-amigavel .message { background: #fff; border: 3px solid #ffcada; }
        .theme-amigavel #score-board { color: #ff4d7d; border-color: #ffcada; }

        .theme-nao-amigavel { background-color: #050000; color: #ff0000; }
        .theme-nao-amigavel #sidebar { background: #000; border-right: 2px solid #ff0000; }
        .theme-nao-amigavel .message { background: #000; border: 1px solid #ff0000; color: #ff4444; }
        .theme-nao-amigavel #score-board { color: #ff0000; border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }

        #input-area { padding: 20px; display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 12px; border-radius: 8px; border: 2px solid #ddd; outline: none; }
        
        .bg-particles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        .particle { position: absolute; bottom: -80px; cursor: pointer; z-index: 20; pointer-events: auto; font-size: 40px; }
        @keyframes moveUp { 0% { transform: translateY(0); opacity: 0.8; } 100% { transform: translateY(-110vh); opacity: 0; } }
    </style>
</head>
<body class="theme-amigavel">

    <div id="login-overlay">
        <div class="login-box">
            <h2>MINECRAFT CHAT LOGIN</h2>
            <input type="text" id="login-user" placeholder="Usu√°rio">
            <input type="password" id="login-pass" placeholder="Senha">
            <button onclick="handleAuth()">ENTRAR / REGISTRAR</button>
        </div>
    </div>

    <div id="main-wrapper">
        <audio id="audio-meow" src="https://actions.google.com/sounds/v1/animals/cat_purr_meow.ogg"></audio>
        <audio id="audio-hiss" src="https://actions.google.com/sounds/v1/horror/ambient_hum_short.ogg"></audio>

        <div id="sidebar">
            <div class="bg-particles" id="sidebar-particles"></div>
            <div id="toggle-btn">‚ù§Ô∏è</div>
            <div id="score-board">Cora√ß√µes: 0</div>
            <button onclick="location.reload()" style="margin-top:20px; cursor:pointer; background:none; border:1px solid #ccc;">Sair</button>
        </div>

        <div id="chat-container">
            <div class="bg-particles" id="chat-particles"></div>
            <div id="header">Modo Amig√°vel</div>
            <div id="messages"></div>
            <div id="input-area">
                <input type="text" id="msg-input" placeholder="Digite sua mensagem...">
                <button id="send-btn" style="background:#ff4d7d; color:white; border-radius:8px; border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">ENVIAR</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onChildAdded, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD7GIQgMVr0lf4BOyQkXBh_Qhk-GK6wMK4",
            authDomain: "chat2000-5815b.firebaseapp.com",
            databaseURL: "https://chat2000-5815b-default-rtdb.firebaseio.com",
            projectId: "chat2000-5815b",
            storageBucket: "chat2000-5815b.firebasestorage.app",
            messagingSenderId: "88820669466",
            appId: "1:88820669466:web:df968acfebc5bd31ec85a3"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        let currentRoom = 'amigavel';
        let scores = { amigavel: 0, infernal: 0 };
        let userNow = "";

        // AUTH
        window.handleAuth = async () => {
            const u = document.getElementById('login-user').value;
            const p = document.getElementById('login-pass').value;
            const email = u + "@chat.com";
            try {
                await signInWithEmailAndPassword(auth, email, p);
            } catch (e) {
                try { await createUserWithEmailAndPassword(auth, email, p); } 
                catch (err) { alert("Erro: " + err.message); }
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                userNow = user.email.split('@')[0];
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('main-wrapper').style.display = 'flex';
                initChatL√≥gica();
            }
        });

        function initChatL√≥gica() {
            // Enviar Mensagem
            document.getElementById('send-btn').onclick = () => {
                const text = document.getElementById('msg-input').value;
                if(text) {
                    push(ref(db, 'msgs/' + currentRoom), { user: userNow, text: text, time: Date.now() });
                    document.getElementById('msg-input').value = '';
                }
            };

            // Receber Mensagem
            onChildAdded(query(ref(db, 'msgs/' + currentRoom), limitToLast(20)), (snap) => {
                const m = snap.val();
                const div = document.createElement('div');
                div.className = `message ${m.user === userNow ? 'my-message' : ''}`;
                div.innerHTML = `<b>${m.user}</b><br>${m.text}`;
                document.getElementById('messages').appendChild(div);
                document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
            });

            // Troca de Tema
            document.getElementById('toggle-btn').onclick = function() {
                const isAmigavel = currentRoom === 'amigavel';
                currentRoom = isAmigavel ? 'infernal' : 'amigavel';
                document.body.className = isAmigavel ? 'theme-nao-amigavel' : 'theme-amigavel';
                this.innerText = isAmigavel ? 'üíÄ' : '‚ù§Ô∏è';
                document.getElementById('header').innerText = isAmigavel ? 'MODO INFERNAL' : 'Modo Amig√°vel';
                document.getElementById('messages').innerHTML = ''; // Limpa pra carregar a outra sala
                location.reload(); // Recarrega para reinserir o listener na sala certa
            };

            // Part√≠culas
            setInterval(() => {
                const p = document.createElement('div');
                p.className = 'particle';
                p.innerText = currentRoom === 'amigavel' ? '‚ù§Ô∏è' : 'üíÄ';
                p.style.left = Math.random() * 90 + '%';
                p.style.animation = "moveUp 4s linear forwards";
                p.onclick = () => {
                    const s = document.getElementById(currentRoom === 'amigavel' ? 'audio-meow' : 'audio-hiss');
                    s.pause(); s.currentTime = 0; s.play();
                    currentRoom === 'amigavel' ? scores.amigavel++ : scores.infernal++;
                    const sb = document.getElementById('score-board');
                    sb.innerText = currentRoom === 'amigavel' ? "Cora√ß√µes: "+scores.amigavel : "Almas: "+scores.infernal;
                    sb.classList.add('bump'); setTimeout(()=>sb.classList.remove('bump'), 100);
                    p.remove();
                };
                document.getElementById('chat-particles').appendChild(p);
                setTimeout(() => p.remove(), 4000);
            }, 1000);
        }
    </script>
</body>
</html>
