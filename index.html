<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Minecraft Pro Chat</title>
    <style>
        @import url('https://fonts.cdnfonts.com/css/minecraftia');
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        * { box-sizing: border-box; }
        body { margin: 0; display: flex; height: 100vh; overflow: hidden; transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); }
        
        /* Sidebar Estilizada */
        #sidebar { width: 30%; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; z-index: 10; transition: inherit; border-right: 4px solid rgba(0,0,0,0.1); }
        #toggle-btn { font-size: 130px; cursor: pointer; transition: 0.3s; user-select: none; z-index: 11; filter: drop-shadow(0 0 10px rgba(0,0,0,0.1)); image-rendering: pixelated; }
        #toggle-btn:hover { transform: scale(1.1) rotate(5deg); }

        /* Container do Chat */
        #chat-container { width: 70%; display: flex; flex-direction: column; position: relative; transition: inherit; }
        #header { padding: 30px; text-align: center; font-size: 24px; font-weight: bold; letter-spacing: 2px; transition: inherit; z-index: 5; }
        #messages { flex: 1; overflow-y: auto; padding: 25px; display: flex; flex-direction: column; gap: 18px; z-index: 5; scroll-behavior: smooth; }
        
        /* Mensagens */
        .message { max-width: 80%; padding: 15px; border-radius: 12px; position: relative; font-size: 14px; line-height: 1.4; transition: 0.3s; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .message img { max-width: 100%; border-radius: 8px; margin-top: 8px; border: 2px solid rgba(0,0,0,0.1); }
        .message audio { width: 100%; margin-top: 8px; border-radius: 30px; }
        .my-message { align-self: flex-end; }

        /* Part√≠culas Clic√°veis */
        .bg-particles { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; overflow: hidden; }
        .particle { position: absolute; bottom: -80px; cursor: pointer; z-index: 20; pointer-events: auto; image-rendering: pixelated; transition: transform 0.1s; filter: drop-shadow(0 0 5px rgba(0,0,0,0.2)); }
        @keyframes moveUp { from { transform: translateY(0) rotate(0deg); } to { transform: translateY(-115vh) rotate(360deg); } }

        /* --- MODO AMIG√ÅVEL (Soft Pink) --- */
        .theme-amigavel { background-color: #ffffff; font-family: 'Minecraftia', sans-serif; }
        .theme-amigavel #sidebar { background: linear-gradient(180deg, #fff5f8 0%, #ffeef2 100%); }
        .theme-amigavel #header { color: #ff4d7d; background: #ffffff; border-bottom: 3px solid #ffeef2; text-shadow: 2px 2px #ffcada; }
        .theme-amigavel .message { background: #fff; border: 3px solid #ffcada; color: #555; box-shadow: 5px 5px 0px #ffeef2; }
        .theme-amigavel .my-message { background: #ff85a2; color: white; border-color: #ff4d7d; box-shadow: 5px 5px 0px #ffcada; }

        /* --- MODO INFERNAL (Cyber Red Hacker) --- */
        .theme-nao-amigavel { background-color: #050000; font-family: 'Share Tech Mono', monospace; }
        .theme-nao-amigavel #sidebar { background: #000; border-right: 2px solid #ff0000; box-shadow: 10px 0 30px rgba(255, 0, 0, 0.2); }
        .theme-nao-amigavel #header { color: #ff0000; background: #000; border-bottom: 2px solid #ff0000; text-shadow: 0 0 15px #ff0000; letter-spacing: 5px; }
        .theme-nao-amigavel #chat-container::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(255,0,0,0.03) 0px, rgba(255,0,0,0.03) 1px, transparent 1px, transparent 2px); pointer-events: none; z-index: 6; }
        .theme-nao-amigavel .message { background: rgba(20, 0, 0, 0.8); border: 1px solid #ff0000; color: #ff4444; box-shadow: 0 0 10px rgba(255, 0, 0, 0.3); }
        .theme-nao-amigavel .my-message { border-color: #ff0000; color: #ffffff; background: #300000; box-shadow: 0 0 15px rgba(255, 0, 0, 0.5); }

        /* Input Area */
        #input-area { padding: 25px; display: flex; gap: 12px; align-items: center; z-index: 10; transition: inherit; }
        input[type="text"] { flex: 1; padding: 15px; outline: none; border-radius: 8px; font-family: inherit; font-size: 15px; border: 2px solid #ddd; transition: 0.3s; }
        
        .theme-amigavel input[type="text"] { border-color: #ffcada; color: #ff4d7d; }
        .theme-nao-amigavel input[type="text"] { background: #000; border: 1px solid #ff0000; color: #ff0000; box-shadow: inset 0 0 5px #ff0000; }
        
        label, button { cursor: pointer; padding: 12px 20px; border-radius: 8px; font-family: inherit; border: none; transition: 0.2s; display: flex; align-items: center; justify-content: center; }
        .theme-amigavel button, .theme-amigavel label { background: #ff4d7d; color: white; box-shadow: 0 4px 0 #d43f6a; }
        .theme-nao-amigavel button, .theme-nao-amigavel label { background: #000; color: #ff0000; border: 1px solid #ff0000; box-shadow: 0 0 10px #ff0000; }
        
        button:active { transform: translateY(3px); box-shadow: none; }
        input[type="file"] { display: none; }
    </style>
</head>
<body class="theme-amigavel">
    <audio id="sound-amigavel" src="https://assets.mixkit.co/active_storage/sfx/2354/2354-preview.mp3"></audio>
    <audio id="sound-nao-amigavel" src="https://assets.mixkit.co/active_storage/sfx/2565/2565-preview.mp3"></audio>

    <div id="sidebar">
        <div class="bg-particles" id="sidebar-particles"></div>
        <div id="toggle-btn">‚ù§Ô∏è</div>
    </div>

    <div id="chat-container">
        <div class="bg-particles" id="chat-particles"></div>
        <div id="header">AMIG√ÅVEL</div>
        <div id="messages"></div>
        <div id="input-area">
            <label for="img-input">üì∑</label>
            <input type="file" id="img-input" accept="image/*">
            <label for="audio-input">üéôÔ∏è</label>
            <input type="file" id="audio-input" accept="audio/*">
            <input type="text" id="msg-input" placeholder="Escreva aqui...">
            <button id="send-btn">ENVIAR</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentRoom = 'amigavel';
        const user = "User_" + Math.floor(Math.random() * 99);
        let pInterval;

        // Fun√ß√£o de envio de mensagens
        function sendMessage() {
            const input = document.getElementById('msg-input');
            if (input.value.trim() !== "") {
                socket.emit('chat message', { room: currentRoom, user: user, text: input.value });
                input.value = '';
            }
        }

        // Atalho Enter
        document.getElementById('msg-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        document.getElementById('send-btn').onclick = sendMessage;

        // Part√≠culas Subindo
        function createParticle(containerId, emoji) {
            const container = document.getElementById(containerId);
            const p = document.createElement('div');
            p.className = 'particle';
            p.innerText = emoji;
            p.style.left = Math.random() * 90 + '%';
            p.style.fontSize = (Math.random() * 20 + 30) + 'px';
            p.style.animation = `moveUp ${(Math.random() * 2 + 3)}s linear forwards`;
            
            p.onclick = function() {
                this.innerText = currentRoom === 'amigavel' ? '‚ú®' : 'üî•';
                this.style.transform = 'scale(2)';
                setTimeout(() => this.remove(), 100);
            };

            container.appendChild(p);
            setTimeout(() => { if(p) p.remove(); }, 4000);
        }

        function startAllParticles(emoji) {
            if (pInterval) clearInterval(pInterval);
            pInterval = setInterval(() => {
                createParticle('sidebar-particles', emoji);
                createParticle('chat-particles', emoji);
            }, 600);
        }

        // Envio de Arquivos
        function sendFile(input, type) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    socket.emit('chat message', { room: currentRoom, user: user, text: '', file: e.target.result, fileType: type });
                };
                reader.readAsDataURL(file);
                input.value = '';
            }
        }
        document.getElementById('img-input').onchange = function() { sendFile(this, 'image'); };
        document.getElementById('audio-input').onchange = function() { sendFile(this, 'audio'); };

        // Toggle de Tema
        document.getElementById('toggle-btn').onclick = function() {
            if (currentRoom === 'amigavel') {
                currentRoom = 'nao-amigavel';
                document.body.className = 'theme-nao-amigavel';
                this.innerText = 'üíÄ';
                document.getElementById('header').innerText = 'MODO INFERNAL';
                startAllParticles('üíÄ');
            } else {
                currentRoom = 'amigavel';
                document.body.className = 'theme-amigavel';
                this.innerText = '‚ù§Ô∏è';
                document.getElementById('header').innerText = 'AMIG√ÅVEL';
                startAllParticles('‚ù§Ô∏è');
            }
            socket.emit('join room', currentRoom);
            document.getElementById('messages').innerHTML = '';
        };

        socket.on('chat message', (msg) => {
            const sound = document.getElementById(currentRoom === 'amigavel' ? 'sound-amigavel' : 'sound-nao-amigavel');
            sound.play().catch(() => {});

            const div = document.createElement('div');
            div.className = 'message ' + (msg.user === user ? 'my-message' : '');
            let content = `<b>${msg.user}</b><br>`;
            if (msg.text) content += `<span>${msg.text}</span>`;
            if (msg.file) {
                if (msg.fileType === 'image') content += `<img src="${msg.file}">`;
                if (msg.fileType === 'audio') content += `<audio controls src="${msg.file}"></audio>`;
            }
            div.innerHTML = content;
            const messagesDiv = document.getElementById('messages');
            messagesDiv.appendChild(div);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });

        startAllParticles('‚ù§Ô∏è');
        socket.emit('join room', 'amigavel');
    </script>
</body>
</html>
