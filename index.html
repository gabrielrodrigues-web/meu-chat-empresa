<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Dual Reality</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; transition: background 0.5s, color 0.5s; }
        
        body { display: flex; height: 100vh; overflow: hidden; position: relative; font-family: 'Comic Sans MS', cursive; }

        /* --- TREMOR --- */
        @keyframes shake {
            0% { transform: translate(0,0); }
            20% { transform: translate(-10px, 5px); }
            40% { transform: translate(10px, -5px); }
            60% { transform: translate(-10px, -5px); }
            100% { transform: translate(0,0); }
        }
        .shake-effect { animation: shake 0.3s ease-in-out; }

        /* --- PART√çCULAS (Estrelas e Bal√µes) --- */
        .particle {
            position: absolute;
            pointer-events: auto;
            z-index: 1;
            animation: rise 5s linear forwards;
            user-select: none;
            cursor: pointer;
        }
        @keyframes rise {
            from { transform: translateY(105vh); opacity: 1; }
            to { transform: translateY(-10vh); opacity: 0; }
        }

        /* --- TEMAS --- */
        body.fofo { background-color: #fff0f5; color: #ff69b4; }
        body.dark { background-color: #050000; color: #ff0000; font-family: 'Courier New', monospace; }

        #left-panel { flex: 1; display: flex; justify-content: center; align-items: center; position: relative; overflow: hidden; border-right: 1px solid rgba(0,0,0,0.1); }
        .dark #left-panel { border-right: 1px solid #440000; background: radial-gradient(circle, #1a0000 0%, #000 70%); }

        #chat-panel { flex: 1.2; display: flex; flex-direction: column; z-index: 5; background: rgba(255, 255, 255, 0.5); backdrop-filter: blur(10px); }
        .dark #chat-panel { background: rgba(0, 0, 0, 0.9); }

        header { padding: 20px; text-align: center; font-weight: bold; font-size: 1.5em; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .dark header { border-bottom: 1px solid #440000; text-shadow: 0 0 10px #ff0000; }

        /* --- DOIS CHATS DIFERENTES --- */
        .chat-container { flex: 1; overflow-y: auto; padding: 20px; display: none; flex-direction: column; gap: 10px; }
        .active-chat { display: flex; }

        .message { max-width: 80%; padding: 12px; font-size: 14px; border-radius: 15px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilo Mensagens Fofas */
        .fofo .msg-me { background: #ffb6c1; color: white; align-self: flex-end; }
        .fofo .msg-others { background: white; border: 1px solid #ffb6c1; align-self: flex-start; }

        /* Estilo Mensagens Dark */
        .dark .msg-me { background: #400000; color: #ff0000; align-self: flex-end; border: 1px solid #ff0000; border-radius: 0; }
        .dark .msg-others { background: #1a1a1a; color: #888; align-self: flex-start; border-radius: 0; }

        /* Input */
        #input-area { padding: 20px; display: flex; gap: 10px; border-top: 1px solid rgba(0,0,0,0.1); }
        .dark #input-area { border-top: 1px solid #440000; }
        input { flex: 1; padding: 12px; border-radius: 20px; border: 1px solid #ccc; outline: none; }
        .dark input { background: #000; border: 1px solid #440000; color: #ff0000; border-radius: 0; }
        button { border: none; padding: 0 25px; font-weight: bold; cursor: pointer; border-radius: 20px; background: #ff69b4; color: white; }
        .dark button { background: #660000; color: white; border-radius: 0; }

        #toggle-btn { font-size: 120px; cursor: pointer; z-index: 10; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    </style>
</head>
<body class="fofo">

    <div id="left-panel">
        <div id="toggle-btn">‚≠ê</div>
    </div>

    <div id="chat-panel">
        <header id="main-header">Conversas Amig√°veis</header>
        
        <div id="messages-fofo" class="chat-container active-chat"></div>
        
        <div id="messages-dark" class="chat-container"></div>

        <form id="input-area">
            <input id="m" autocomplete="off" placeholder="Diga algo amig√°vel..." />
            <button>ENVIAR</button>
        </form>
    </div>

    <script>
        const socket = io();
        const userNumber = Math.floor(Math.random() * 999) + 1;
        const body = document.body;
        const toggleBtn = document.getElementById('toggle-btn');
        const header = document.getElementById('main-header');
        const inputField = document.getElementById('m');

        // --- Gerador de Part√≠culas (Estrelas ou Bal√µes) ---
        function createParticle() {
            const isFofo = body.classList.contains('fofo');
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.innerText = isFofo ? '‚ú®' : 'üéà';
            particle.style.left = Math.random() * 100 + 'vw';
            particle.style.fontSize = (Math.random() * 20 + 15) + 'px';
            particle.style.animationDuration = (Math.random() * 2 + 3) + 's';
            
            particle.onmouseover = () => {
                particle.innerText = isFofo ? 'üí•' : 'ü©∏';
                setTimeout(() => particle.remove(), 200);
            };

            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 5000);
        }
        setInterval(createParticle, 200); // Muitas part√≠culas

        // --- Alternar entre Mundos ---
        toggleBtn.addEventListener('click', () => {
            body.classList.add('shake-effect');
            setTimeout(() => body.classList.remove('shake-effect'), 300);

            const chatFofo = document.getElementById('messages-fofo');
            const chatDark = document.getElementById('messages-dark');

            if (body.classList.contains('fofo')) {
                body.className = 'dark';
                toggleBtn.innerText = 'üéà';
                header.innerText = 'Conversas Nada Amig√°veis';
                inputField.placeholder = "Diga algo terr√≠vel...";
                chatFofo.classList.remove('active-chat');
                chatDark.classList.add('active-chat');
            } else {
                body.className = 'fofo';
                toggleBtn.innerText = '‚≠ê';
                header.innerText = 'Conversas Amig√°veis';
                inputField.placeholder = "Diga algo amig√°vel...";
                chatDark.classList.remove('active-chat');
                chatFofo.classList.add('active-chat');
            }
        });

        // --- Enviar Mensagem ---
        document.getElementById('input-area').onsubmit = (e) => {
            e.preventDefault();
            if (inputField.value.trim()) {
                const mode = body.classList.contains('fofo') ? 'fofo' : 'dark';
                socket.emit('chat message', {
                    id: socket.id,
                    user: "Usu√°rio " + userNumber,
                    text: inputField.value,
                    mode: mode // Envia o modo atual da mensagem
                });
                inputField.value = '';
            }
        };

        // --- Receber Mensagem ---
        socket.on('chat message', (msg) => {
            const item = document.createElement('div');
            const isMe = msg.id === socket.id;
            item.className = isMe ? 'message msg-me' : 'message msg-others';
            item.innerHTML = `<strong>${msg.user}:</strong> ${msg.text}`;

            // Adiciona a mensagem ao chat correspondente ao modo em que ela foi enviada
            const targetChat = msg.mode === 'fofo' 
                ? document.getElementById('messages-fofo') 
                : document.getElementById('messages-dark');
            
            targetChat.appendChild(item);
            targetChat.scrollTop = targetChat.scrollHeight;

            // Auto-delete ap√≥s 1 minuto
            setTimeout(() => {
                item.style.opacity = '0';
                setTimeout(() => item.remove(), 1000);
            }, 60000);
        });
    </script>
</body>
</html>
